package com.niit.shoppingcart.test;

import org.junit.Assert;
import org.junit.Before;
import org.junit.Test;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.context.annotation.AnnotationConfigApplicationContext;

import com.niit.shoppingcart.Employee;
import com.niit.shoppingcart.config.AppConfig;
import com.niit.shoppingcart.dao.EmployeeDAO;
import com.niit.shoppingcart.dao.EmployeeDao3;



public class EmployeeTestCase {

	/*@Autowired
	EmployeeDao3 dao;*/
	
	@Autowired
	EmployeeDAO dao;
	
	@Autowired 
	AnnotationConfigApplicationContext context;

	@Autowired
	Employee e;
	
	@Before
	public void init(){
		context = new AnnotationConfigApplicationContext(AppConfig.class);
		//context.refresh();
		System.out.println("dao="+dao);
		//context.scan("com.niit.shoppingcart");
		dao = (EmployeeDAO) context.getBean("EmployeeDAO");
		//dao = (EmployeeDao3) context.getBean("EmployeeDao");
		
		e = (Employee) context.getBean("employee");
		
		System.out.println("dao="+dao);
		
	}
	
	@Test
	public void getEmployee() {
		Assert.assertNotNull("Get employee", dao.getById(14));
	}
	
	@Test
	public void createEmployee(){
		
		int id = 1002;
		e = new Employee();
		e.setEid(id);
		e.setName("name 20");
		e.setSalary(60000);
		
		Employee emp = dao.getById(id);
		
		// checks whether employee with the specified id does not exist already
		// if it exists increment the id
		do{
			id+=1;
			e.setEid(id);
			emp = dao.getById(id);
		}while(emp != null);
				
		dao.saveEmployee(e);
		
		Assert.assertNotNull("Get employee", dao.getById(id));	
	}
	
	@Test
	public void deleteEmployee(){
		
		int id=2000;
		
		
		Employee emp = dao.getById(id);
		//Assert.assertNotNull("check employee exists", emp);
		
		if(emp != null){
			dao.deleteEmployee(emp);	
			Assert.assertNull("delete employee", dao.getById(id));
		}
		else
		{
			// creates a record with the id and then delete
			e.setEid(id);
			dao.saveEmployee(e);
			emp = dao.getById(id);
			
			//checks whether record is created before deleting
			Assert.assertNotNull(dao.getById(id));
			// deletes the record
			dao.deleteEmployee(emp);
			//checks whether record is deleted 
			Assert.assertNull(dao.getById(id));
			
		}
	}
	
	@Test
	public void updateEmployee(){
		int id=1002;
		
		// update the employee
		Employee emp = dao.getById(id);
		//Assert.assertNotNull("check employee exists", emp);
		if(emp != null){
			emp.setName("updated name 1002");
			dao.updateEmployee(emp);
			
			Assert.assertEquals(emp, dao.getById(id));
		}
		else
		{
			// creates a record with the id and then update
			e.setEid(id);
			dao.saveEmployee(e);
			emp = dao.getById(id);
			
			//checks whether record is created before deleting
			Assert.assertNotNull(dao.getById(id));
			// updates the record
			emp.setName("updated name "+id);
			dao.deleteEmployee(emp);
			//checks whether record is deleted 
			Assert.assertNull(dao.getById(id));
		}
	}

	@Test
	public void getEmployeeList() {
		Assert.assertNotNull("Get employee", dao.getEmployees());
		
		//Assert.assertEquals(10, dao.getEmployees().size());
	}
}
